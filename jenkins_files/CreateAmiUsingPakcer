pipeline {

    agent any

    stages{
	    stage ('Setup Parameters') {
	        steps{
                script {
                            properties([
                            choice(
                                choices: ['web', 'java', 'mysql'],
                                name: "APP_IMAGE_TYPE"

                            ),
                            string(
                                    name: 'AWS_ACCESS_KEY', 
                                    defaultValue: '', 
                                    description: 'Add AWS Access key'
                            ),
                            string(
                                    name: 'AWS_SECRET_KEY', 
                                    defaultValue: '', 
                                    description: 'Add AWS Secret key'
                            ),
                        ])
                }

	        }
        }

        stage ('Build AMI image using packer based on web type'){
            
            steps{
                    script{
                        def packer_file_name = "packer_${APP_IMAGE_TYPE}.json"
                        sh '''
                        cd packer-demo/${APP_IMAGE_TYPE}
                        /usr/local/bin/packer build ${packer_file_name}
                        
                        '''
                    }
            }
            



        }




    }
}
